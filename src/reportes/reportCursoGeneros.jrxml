<?xml version="1.0" encoding="UTF-8"?>
<!--
    VERSIÓN FINAL CORREGIDA Y MEJORADA
    - Se ha corregido el error de sintaxis 'SAXParseException' moviendo la etiqueta <pen> a su lugar correcto.
    - Se ha refinado la estética para un acabado aún más profesional.
-->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="reporte_profesional_estudiantes" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="0e8d1a4a-1b1f-4b7c-8e8e-1f1f1f1f1f1f">
    <property name="ireport.zoom" value="1.21"/>
    <property name="ireport.x" value="0"/>
    <property name="ireport.y" value="0"/>

    <!-- ===== SECCIÓN DE ESTILOS PROFESIONALES ===== -->
    <style name="ReportTitle" fontName="Arial" fontSize="22" isBold="true" forecolor="#2C5A8D"/>
    <style name="ReportSubtitle" fontName="Arial" fontSize="12" forecolor="#555555"/>
    <style name="TableHeader" mode="Opaque" backcolor="#2C5A8D" forecolor="#FFFFFF" fontName="Arial" fontSize="10" isBold="true" hAlign="Center" vAlign="Middle"/>
    <style name="TableRow" fontName="Arial" fontSize="9" vAlign="Middle">
        <box topPadding="5" leftPadding="5" bottomPadding="5" rightPadding="5"/>
    </style>
    <style name="PageFooter" fontName="Arial" fontSize="8" isItalic="true" forecolor="#555555"/>

    <!-- ===== PARÁMETROS Y CONSULTA ===== -->
       
    <parameter name="IMAGEN_HEADER" class="java.io.InputStream"/>
	
    <queryString>
		<![CDATA[SELECT c.nom_cur, 
       e.gen_est, 
       COUNT(*) AS total_estudiantes
FROM estudiantes e, cursos c, inscripciones i
WHERE e.id_est = i.id_est_ins 
  AND i.id_cur_ins = c.id_cur
GROUP BY c.nom_cur, e.gen_est
ORDER BY c.nom_cur, e.gen_est;]]>
    </queryString>

    <!-- ===== CAMPOS ===== -->
    <field name="nom_cur" class="java.lang.String"/>
    <field name="gen_est" class="java.lang.String"/>
    <field name="total_estudiantes" class="java.lang.Long"/>
    <background>
        <band splitType="Stretch"/>
    </background>

    <!-- ===== BANDA DE TÍTULO (SOLO IMAGEN) ===== -->
    <title>
        <band height="180" splitType="Stretch">
            <image scaleImage="FillFrame">
                <reportElement x="0" y="0" width="555" height="180" uuid="2c0b4df2-841a-45d8-b45c-e7786ba249b0"/>
                <imageExpression><![CDATA[$P{IMAGEN_HEADER}]]></imageExpression>
            </image>
        </band>
    </title>

    <!-- ===== CABECERA DE PÁGINA REDISEÑADA ===== -->
    <pageHeader>
        <band height="70" splitType="Stretch">
            <staticText>
                <reportElement style="ReportTitle" x="0" y="10" width="555" height="30" uuid="665cb506-c3fc-4433-af99-eddf13e40062"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <text><![CDATA[LISTADO DE ESTUDIANTES INSCRITOS]]></text>
            </staticText>
            <textField isStretchWithOverflow="true">
                <reportElement style="ReportSubtitle" x="0" y="40" width="555" height="20" uuid="7330199e-c7c2-4493-b246-8d9b80e18c40"/>
                <textElement textAlignment="Center" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA["Curso: " + $P{cursoSeleccionado}]]></textFieldExpression>
            </textField>
        </band>
    </pageHeader>

    <!-- ===== CABECERA DE COLUMNAS (TABLA MODERNA) ===== -->
    <columnHeader>
		<band height="25" splitType="Stretch">
			<staticText>
				<reportElement style="TableHeader" x="0" y="0" width="160" height="25" uuid="c1d2e3f4-a5b6-c7d8-e9f0-a1b2c3d4e5f6"/>
				<text><![CDATA[CURSO]]></text>
			</staticText>
			<staticText>
				<reportElement style="TableHeader" x="368" y="0" width="160" height="25" uuid="e1f2a3b4-c5d6-e7f8-a9b0-c1d2e3f4a5b6"/>
				<text><![CDATA[TOTAL ESTUDIANTES]]></text>
			</staticText>
			<staticText>
				<reportElement style="TableHeader" x="179" y="0" width="160" height="25" uuid="d1e2f3a4-b5c6-d7e8-f9a0-b1c2d3e4f5a6"/>
				<text><![CDATA[GÉNERO]]></text>
			</staticText>
		</band>
	</columnHeader>

    <!-- ===== BANDA DE DETALLE (TABLA CON FILAS ALTERNADAS) ===== -->
   <detail>
		<band height="26" splitType="Stretch">
			<rectangle>
				<reportElement mode="Opaque" x="0" y="0" width="555" height="25" backcolor="#F7F7F7" uuid="a0a0a0a0-b1b1-c2c2-d3d3-e4e4e4e4e4e4">
					<printWhenExpression><![CDATA[$V{REPORT_COUNT}%2 == 0]]></printWhenExpression>
				</reportElement>
				<graphicElement>
					<pen lineWidth="0.0"/>
				</graphicElement>
			</rectangle>
			<textField isStretchWithOverflow="true">
				<reportElement style="TableRow" x="0" y="0" width="160" height="25" uuid="b3c4d5e6-f7a8-b9c0-d1e2-f3a4b5c6d7e8"/>
				<textFieldExpression><![CDATA[$F{nom_cur}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement style="TableRow" x="179" y="0" width="160" height="25" uuid="c4d5e6f7-a8b9-c0d1-e2f3-a4b5c6d7e8f9"/>
				<textFieldExpression><![CDATA[$F{gen_est}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement style="TableRow" x="368" y="0" width="160" height="25" uuid="d5e6f7a8-b9c0-d1e2-f3a4-b5c6d7e8f9a0"/>
				<textFieldExpression><![CDATA[$F{total_estudiantes}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	
    <!-- ===== PIE DE PÁGINA MEJORADO ===== -->
    <pageFooter>
        <band height="30" splitType="Stretch">
            <line>
                <reportElement x="0" y="5" width="555" height="1" forecolor="#CCCCCC" uuid="a1b2c3d4-e5f6-a7b8-c9d0-e1f2a3b4c5d6"/>
            </line>
            <textField pattern="dd/MM/yyyy HH:mm">
                <reportElement style="PageFooter" x="0" y="10" width="200" height="20" uuid="b1c2d3e4-f5a6-b7c8-d9e0-f1a2b3c4d5e6"/>
                <textElement verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement style="PageFooter" x="435" y="10" width="80" height="20" uuid="2dc2397a-80d4-4fd9-b640-01c23c22fbba"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA["Página "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
            </textField>
            <textField evaluationTime="Report">
                <reportElement style="PageFooter" x="515" y="10" width="40" height="20" uuid="8d5377a6-b882-4706-b4fc-61ef8bca4a10"/>
                <textElement verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
            </textField>
        </band>
    </pageFooter>
    <summary>
		<band height="329">
			<bar3DChart>
				<chart>
					<reportElement x="68" y="94" width="447" height="211" uuid="9e6929e9-e262-4335-a890-54a944ad2d6a"/>
					<chartTitle/>
					<chartSubtitle/>
					<chartLegend/>
				</chart>
				<categoryDataset>
					<categorySeries>
						<seriesExpression><![CDATA[$F{gen_est}]]></seriesExpression>
						<categoryExpression><![CDATA[$F{nom_cur}]]></categoryExpression>
						<valueExpression><![CDATA[$F{total_estudiantes}]]></valueExpression>
					</categorySeries>
				</categoryDataset>
				<bar3DPlot>
					<plot/>
					<itemLabel/>
					<categoryAxisFormat>
						<axisFormat/>
					</categoryAxisFormat>
					<valueAxisFormat>
						<axisFormat/>
					</valueAxisFormat>
				</bar3DPlot>
			</bar3DChart>
		</band>
	</summary>
</jasperReport>